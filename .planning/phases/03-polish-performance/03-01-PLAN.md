---
phase: 03-polish-performance
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - index.html
autonomous: true
must_haves:
  truths:
    - CSS animation timing variables exist in :root (--anim-quick, --anim-medium, --anim-slow)
    - Existing hardcoded durations replaced with CSS variable references
    - Animation timing hierarchy documented in comments
    - Stage transition timing remains at 450ms (consistent with current behavior)
  artifacts:
    - path: index.html
      provides: Animation timing CSS variables in :root
      contains: "--anim-quick: 150ms; --anim-medium: 450ms; --anim-slow: 600ms;"
    - path: index.html
      provides: Updated transition rules using var(--anim-*)
      pattern: "duration-[var(--anim-quick)]|var(--anim-medium)|var(--anim-slow)"
  key_links: []
---

<objective>
Add CSS custom properties for animation timing hierarchy and update existing CSS to use them. The stage-transition animation system already exists and works correctly - this plan focuses on adding design tokens for maintainability.

Purpose: Centralized animation timing makes the design system maintainable and consistent. Future timing adjustments only require changing variable values, not hunting through CSS.
</objective>

<execution_context>
@/Users/yevgenschweden/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/yevgenschweden/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/phases/03-polish-performance/03-CONTEXT.md
@.planning/phases/03-polish-performance/03-RESEARCH.md

**Current State (from research):**
The following ALREADY EXISTS and works correctly:
- `.stage-transition` class with fadeSlideIn animation (index.html line 122-135)
- Root wrapper with `stage-transition` class and `key={state.stage}` in App.tsx line 1259
- Hardcoded durations: 0.5s for stage-transition, 0.3s for buttons, 0.7s for progress-bar

**What needs to be ADDED:**
- CSS custom properties for animation timing hierarchy
- Replace hardcoded values with variable references
- Documentation comment explaining the timing system

**No changes needed to:**
- App.tsx (stage-transition wrapper already correct)
- Animation easing curves (keep cubic-bezier(0.25, 0.46, 0.45, 0.94))
- Animation keyframes (fadeSlideIn already exists)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add animation timing CSS variables to :root</name>
  <files>index.html</files>
  <action>
Add CSS custom properties for animation timing hierarchy in the :root selector. Add inside the `<style>` block, before any other CSS (around line 17, after the @import):

```css
:root {
  /* Animation Timing Hierarchy
     Quick (150ms): Button hovers, micro-interactions, feedback
     Medium (450ms): Stage transitions, card swipes, progress bars  
     Slow (600ms): Emphasis animations, celebrations, modal overlays
     
     Easing: cubic-bezier(0.25, 0.46, 0.45, 0.94) - smooth ease-out
     Stage transitions use fade only (no directional movement)
     to avoid confusion with swipe gestures.
  */
  --anim-quick: 150ms;
  --anim-medium: 450ms;
  --anim-slow: 600ms;
}
```

This creates a centralized timing system that can be referenced throughout the CSS.
  </action>
  <verify>
    grep -A 3 "Animation Timing Hierarchy" index.html && echo "Variables defined" || echo "Variables NOT found"
    grep -n "--anim-quick: 150ms" index.html
    grep -n "--anim-medium: 450ms" index.html
    grep -n "--anim-slow: 600ms" index.html
  </verify>
  <done>
    CSS custom properties --anim-quick, --anim-medium, --anim-slow defined in :root with documentation comment explaining the timing hierarchy
  </done>
</task>

<task type="auto">
  <name>Task 2: Update stage-transition to use CSS variable</name>
  <files>index.html</files>
  <action>
Update the existing `.stage-transition` class (line ~122) to use the CSS variable instead of hardcoded 0.5s.

**Current code:**
```css
.stage-transition {
    animation: fadeSlideIn 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
}
```

**Change to:**
```css
.stage-transition {
    animation: fadeSlideIn var(--anim-medium) cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
}
```

Note: Using 450ms (within the Medium 300-500ms range) instead of 500ms to align with timing hierarchy.
  </action>
  <verify>
    grep -n "stage-transition" index.html | head -5
    grep "var(--anim-medium)" index.html
  </verify>
  <done>
    .stage-transition animation uses var(--anim-medium) instead of hardcoded 0.5s
  </done>
</task>

<task type="auto">
  <name>Task 3: Update button transitions to use CSS variable</name>
  <files>index.html</files>
  <action>
Update the button transition rule (line ~216) to use the quick timing variable.

**Current code:**
```css
button {
    transition: all 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    border-radius: 0 !important;
}
```

**Change to:**
```css
button {
    transition: all var(--anim-quick) cubic-bezier(0.25, 0.46, 0.45, 0.94);
    border-radius: 0 !important;
}
```

This changes button hover timing from 300ms to 150ms for snappier feedback.
  </action>
  <verify>
    grep -A 2 "^button {" index.html | grep "var(--anim-quick)"
  </verify>
  <done>
    Button transitions use var(--anim-quick) instead of hardcoded 0.3s
  </done>
</task>

<task type="auto">
  <name>Task 4: Update progress-bar transition timing</name>
  <files>index.html</files>
  <action>
Update the progress-bar transition (line ~222) to use the medium timing variable.

**Current code:**
```css
.progress-bar {
    transition: width 0.7s cubic-bezier(0.25, 0.46, 0.45, 0.94);
}
```

**Change to:**
```css
.progress-bar {
    transition: width var(--anim-medium) cubic-bezier(0.25, 0.46, 0.45, 0.94);
}
```

This changes progress bar animation from 700ms to 450ms for consistency with stage transitions.
  </action>
  <verify>
    grep -A 1 "\.progress-bar {" index.html | grep "var(--anim-medium)"
  </verify>
  <done>
    Progress bar transitions use var(--anim-medium) instead of hardcoded 0.7s
  </done>
</task>

<task type="auto">
  <name>Task 5: Update hover-scale timing</name>
  <files>index.html</files>
  <action>
Update the hover-scale transition (line ~259-261) to use the quick timing variable.

**Current code:**
```css
.hover-scale {
    transition: transform 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94), 
                box-shadow 0.3s ease;
}
```

**Change to:**
```css
.hover-scale {
    transition: transform var(--anim-quick) cubic-bezier(0.25, 0.46, 0.45, 0.94), 
                box-shadow var(--anim-quick) ease;
}
```
  </action>
  <verify>
    grep -A 2 "\.hover-scale {" index.html | grep "var(--anim-quick)"
  </verify>
  <done>
    hover-scale transitions use var(--anim-quick) instead of hardcoded 0.3s
  </done>
</task>

<task type="auto">
  <name>Task 6: Verify with browser - test stage transitions</name>
  <files></files>
  <action>
Use agent-browser to verify that stage transitions still work correctly after timing changes.

**Steps:**
1. Start the dev server if not running: `bun dev`
2. Open http://localhost:3000 in agent-browser
3. Click "Boot system" to navigate to Personality Select
4. Verify the transition animation plays smoothly
5. Select a personality to go to Role Select
6. Verify transition still works
7. Continue through Initializing â†’ Game to see multiple transitions

**What to verify:**
- Transitions feel smooth (not jarring)
- Timing doesn't feel rushed (150ms button, 450ms stage transitions)
- No visual glitches or broken animations

**Command:**
```bash
# Check if dev server is running
lsof -i :3000 2>/dev/null || echo "Start server: bun dev"

# Browser verification
agent-browser open http://localhost:3000
agent-browser snapshot -i
# Click Boot system button
agent-browser click @e1  # or appropriate ref
```
  </action>
  <verify>
    echo "Browser verification: Navigate through all 8 stages, verify transitions feel smooth"
    echo "Quick (150ms): Button hovers should feel snappy"
    echo "Medium (450ms): Stage transitions should feel smooth, not rushed"
  </verify>
  <done>
    Browser verification confirms all stage transitions work correctly with new timing values
  </done>
</task>

</tasks>

<verification>
1. :root contains --anim-quick: 150ms, --anim-medium: 450ms, --anim-slow: 600ms
2. Documentation comment explains timing hierarchy and rationale
3. .stage-transition uses var(--anim-medium)
4. button transition uses var(--anim-quick)
5. .progress-bar uses var(--anim-medium)
6. .hover-scale uses var(--anim-quick)
7. Browser test confirms transitions work correctly
</verification>

<success_criteria>
- CSS animation timing hierarchy implemented with variables
- All hardcoded durations replaced with var(--anim-*)
- Stage transitions remain smooth at 450ms (was 500ms)
- Button hovers feel snappier at 150ms (was 300ms)
- Documentation explains the timing system
- Browser verification confirms no regressions
</success_criteria>

<output>
After completion, create `.planning/phases/03-polish-performance/03-01-SUMMARY.md`
</output>
