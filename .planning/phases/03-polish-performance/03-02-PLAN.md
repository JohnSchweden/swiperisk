---
phase: 03-polish-performance
plan: 02
type: execute
wave: 1
depends_on:
  - 03-01
files_modified:
  - index.html
  - App.tsx
autonomous: true
must_haves:
  truths:
    - Design system CSS variables exist for colors, typography, spacing
    - Navigation screens (Intro, Personality, Role, Initializing) use explicit bg-[#0a0a0c]
    - Gameplay screens (Game, Boss) use bg-[#0a0a0c] (already correct)
    - Outcome screens (GameOver, Summary) keep semantic tints
    - Button styles standardized to 3 variants with documented patterns
    - Container widths follow hierarchy: wide (nav), standard (gameplay), narrow (outcome)
  artifacts:
    - path: index.html
      provides: Design system CSS variables
      contains: "--color-bg-primary, --color-accent, --text-lg, --space-4"
    - path: App.tsx
      provides: Standardized background colors on navigation screens
      pattern: "LayoutShell className=\".*bg-\[#0a0a0c\]"
  key_links: []
---

<objective>
Conduct design system standardization by adding CSS custom properties and aligning screen implementations. Focus on the gaps identified in research: navigation screen backgrounds need explicit colors, button variants need documentation, and design tokens need to be defined.

Purpose: Users experience a cohesive visual system. Centralized design tokens make future changes easier, and explicit background colors ensure consistency across all 8 screens.
</objective>

<execution_context>
@/Users/yevgenschweden/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/yevgenschweden/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/phases/03-polish-performance/03-CONTEXT.md
@.planning/phases/03-polish-performance/03-RESEARCH.md

**Current State (from research):**

**Background colors - INCONSISTENT:**
- renderIntro: No explicit bg (inherits)
- renderPersonalitySelect: No explicit bg (inherits)
- renderRoleSelect: No explicit bg (inherits)
- renderInitializing: bg-black (line 797)
- renderGame: bg-[#0a0a0c] (line 834) ✅
- renderBossFight: bg-[#0a0a0c] (line 1056) ✅
- renderGameOver: bg-[#1a0505] (line 1147) ✅ semantic
- renderSummary: bg-[#051a0d] (line 1200) ✅ semantic

**Container widths - INCONSISTENT:**
- renderIntro: No max-w container
- renderPersonalitySelect: max-w-5xl
- renderRoleSelect: max-w-4xl
- renderInitializing: max-w-xl
- renderGame: max-w-full lg:max-w-[43rem]
- renderBossFight: max-w-3xl
- renderGameOver: max-w-2xl
- renderSummary: max-w-2xl

**Button styles - VARIED but functional:**
- Primary CTA: Intro, GameOver, Summary (each styled differently)
- Card buttons: PersonalitySelect, RoleSelect
- Action buttons: Game (swipe buttons)

**No design tokens exist yet** - all colors/spacing hardcoded

**Key decision:** Research confirmed navigation screens should use explicit bg-[#0a0a0c] like gameplay screens. Semantic colors for GameOver/Summary are intentional and should remain.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create design system CSS variables</name>
  <files>index.html</files>
  <action>
Add comprehensive design token CSS variables to the :root selector (after the animation variables from Plan 03-01). Add these in the :root block:

```css
  /* Design System - Colors */
  --color-bg-primary: #0a0a0c;
  --color-bg-failure: #1a0505;
  --color-bg-success: #051a0d;
  --color-bg-tertiary: #1e293b;
  --color-text-primary: #f8fafc;
  --color-text-secondary: #94a3b8;
  --color-text-muted: #64748b;
  --color-accent: #22d3ee;
  --color-accent-hover: #06b6d4;
  --color-success: #22c55e;
  --color-warning: #eab308;
  --color-danger: #ef4444;
  
  /* Design System - Typography Scale */
  --text-xs: 0.75rem;
  --text-sm: 0.875rem;
  --text-base: 1rem;
  --text-lg: 1.125rem;
  --text-xl: 1.25rem;
  --text-2xl: 1.5rem;
  --text-3xl: 1.875rem;
  --text-4xl: 2.25rem;
  --text-5xl: 3rem;
  --text-6xl: 3.75rem;
  
  /* Design System - Spacing Scale */
  --space-1: 0.25rem;
  --space-2: 0.5rem;
  --space-3: 0.75rem;
  --space-4: 1rem;
  --space-6: 1.5rem;
  --space-8: 2rem;
  --space-10: 2.5rem;
  --space-12: 3rem;
  --space-16: 4rem;
  
  /* Design System - Border Radius */
  --radius-sm: 0.25rem;
  --radius-md: 0.375rem;
  --radius-lg: 0.5rem;
  --radius-xl: 0.75rem;
  --radius-2xl: 1rem;
  
  /* Design System - Shadows */
  --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
  --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
  --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
  --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
  --shadow-glow: 0 0 20px rgba(34, 211, 238, 0.3);
```

This creates a centralized design system. Note: We're adding tokens now for future use; full migration from Tailwind classes to CSS variables is out of scope for this phase.
  </action>
  <verify>
    grep -n "--color-bg-primary" index.html
    grep -n "--text-xs" index.html
    grep -n "--space-4" index.html
    grep -n "--radius-md" index.html
    grep -n "--shadow-lg" index.html
  </verify>
  <done>
    CSS design tokens defined for colors, typography, spacing, border-radius, and shadows in :root
  </done>
</task>

<task type="auto">
  <name>Task 2: Add explicit backgrounds to navigation screens</name>
  <files>App.tsx</files>
  <action>
Add explicit `bg-[#0a0a0c]` background to the LayoutShell className for navigation screens that currently inherit.

**Changes needed:**

1. **renderIntro** (around line 665):
   ```jsx
   <LayoutShell className="p-4 md:p-6 text-center bg-[#0a0a0c]">
   ```

2. **renderPersonalitySelect** (around line 693):
   ```jsx
   <LayoutShell className="p-4 md:p-6 bg-[#0a0a0c]">
   ```

3. **renderRoleSelect** (around line 743):
   ```jsx
   <LayoutShell className="p-4 md:p-6 bg-[#0a0a0c]">
   ```

4. **renderInitializing** (around line 797):
   Change from `bg-black` to `bg-[#0a0a0c]`:
   ```jsx
   <LayoutShell className="p-4 md:p-6 bg-[#0a0a0c] text-cyan-500 font-mono">
   ```

**Screens that are already correct (no changes):**
- renderGame: Already has `bg-[#0a0a0c]` ✅
- renderBossFight: Already has `bg-[#0a0a0c]` ✅
- renderGameOver: Has semantic `bg-[#1a0505]` ✅ (keep)
- renderSummary: Has semantic `bg-[#051a0d]` ✅ (keep)
  </action>
  <verify>
    grep -n "LayoutShell className" App.tsx | head -10
    echo "Checking for bg-[#0a0a0c] on navigation screens..."
    grep -A 1 "renderIntro = () =>" App.tsx | grep "bg-"
    grep -A 1 "renderPersonalitySelect = () =>" App.tsx | grep "bg-"
    grep -A 1 "renderRoleSelect = () =>" App.tcx | grep "bg-"
    grep -A 1 "renderInitializing = () =>" App.tsx | grep "bg-"
  </verify>
  <done>
    Navigation screens (Intro, Personality, Role, Initializing) use explicit bg-[#0a0a0c]
  </done>
</task>

<task type="auto">
  <name>Task 3: Document button variant patterns</name>
  <files>App.tsx</files>
  <action>
Add a comment block at the top of App.tsx (after imports, around line 6) documenting the 3 button variants used across screens. This creates a reference for future maintenance without changing working code.

```typescript
/**
 * BUTTON VARIANT PATTERNS (established design system)
 * 
 * Primary CTA (Boot system, Reboot, Log off):
 * - White background, black text
 * - Large padding (px-6 py-3 md:px-12 md:py-4)
 * - Cyan hover state
 * - Used on: Intro, GameOver, Summary
 * 
 * Card Selection (Personality, Role):
 * - Slate-900/60 background
 * - Slate-800 border
 * - Cyan border on hover
 * - Large padding (p-6 md:p-8/10)
 * - Used on: PersonalitySelect, RoleSelect
 * 
 * Action Button (Swipe choices):
 * - Transparent background
 * - White border
 * - White text
 * - Cyan hover state
 * - Used on: Game screen swipe buttons
 */
```

This documents existing patterns without forcing rigid standardization that might break contextual styling needs.
  </action>
  <verify>
    grep -n "BUTTON VARIANT PATTERNS" App.tsx
  </verify>
  <done>
    Button variant patterns documented in comment block at top of App.tsx
  </done>
</task>

<task type="auto">
  <name>Task 4: Document container width strategy</name>
  <files>App.tsx</files>
  <action>
Add a comment documenting the container width strategy for the 8 screens. Add after the button documentation (around line 30):

```typescript
/**
 * CONTAINER WIDTH STRATEGY
 * 
 * Wide (max-w-5xl): Personality Select
 *   - Needs room for 3-column grid at md breakpoint
 * 
 * Standard (max-w-4xl / lg:max-w-[43rem]): Game, BossFight
 *   - Game needs specific width for card proportions
 *   - BossFight uses max-w-3xl currently, could standardize to max-w-4xl
 * 
 * Narrow (max-w-2xl): Initializing, GameOver, Summary
 *   - Focused content that doesn't need wide layout
 * 
 * Auto (no max-w): Intro, Role Select
 *   - Intro uses centered text, max-w on content elements instead
 *   - Role Select uses 2-3 column grid, width adapts naturally
 */
```

This documents the current strategy without forcing changes that might break responsive layouts.
  </action>
  <verify>
    grep -n "CONTAINER WIDTH STRATEGY" App.tsx
  </verify>
  <done>
    Container width strategy documented in comment block
  </done>
</task>

<task type="auto">
  <name>Task 5: Verify design consistency with browser</name>
  <files></files>
  <action>
Use agent-browser to verify visual consistency across all 8 screens.

**Verification steps:**
1. Start dev server: `bun dev`
2. Open http://localhost:3000
3. Navigate through all 8 stages and verify:
   - Background colors are consistent (dark #0a0a0c for 6 screens, semantic for 2)
   - No visual jumps or inconsistencies
   - Text remains readable on all backgrounds
   - Button styles feel cohesive within their categories

**Screens to check:**
1. Intro - verify bg-[#0a0a0c] applied
2. Personality - verify bg-[#0a0a0c] applied
3. Role - verify bg-[#0a0a0c] applied  
4. Initializing - verify bg-[#0a0a0c] applied
5. Game - verify existing bg-[#0a0a0c] still works
6. Boss - verify existing bg-[#0a0a0c] still works
7. GameOver - verify semantic bg-[#1a0505] preserved
8. Summary - verify semantic bg-[#051a0d] preserved

**Commands:**
```bash
# Check if dev server is running
lsof -i :3000 2>/dev/null || echo "Start server: bun dev"

# Browser verification
agent-browser open http://localhost:3000
agent-browser snapshot -i
# Navigate through each stage, capture screenshots
```
  </action>
  <verify>
    echo "Browser verification: Check all 8 screens for consistent backgrounds"
    echo "- 6 screens should use #0a0a0c (navigation + gameplay)"
    echo "- GameOver should use #1a0505 (red-tinted)"
    echo "- Summary should use #051a0d (green-tinted)"
  </verify>
  <done>
    Browser verification confirms all screens have appropriate backgrounds
  </done>
</task>

<task type="auto">
  <name>Task 6: Run visual regression tests</name>
  <files>tests/</files>
  <action>
Run Playwright tests to verify no visual regressions from the background color changes.

**Test command:**
```bash
# Run all tests
bun run test

# Or specifically visual/screenshot tests if they exist
npx playwright test --project=chromium
```

**What to verify:**
- All 8 screens render without errors
- No visual regressions in existing tests
- Background colors don't break any test assertions

**If tests fail:**
- Review screenshot diffs
- Update test baselines if changes are intentional
- Fix any broken selectors or assertions
  </action>
  <verify>
    bun run test 2>&1 | tail -20
    echo "Check for test failures related to background colors or LayoutShell"
  </verify>
  <done>
    All Playwright tests pass, no visual regressions from design system changes
  </done>
</task>

</tasks>

<verification>
1. Design system CSS variables defined in :root (colors, typography, spacing, radius, shadows)
2. Navigation screens have explicit bg-[#0a0a0c]:
   - renderIntro: bg-[#0a0a0c] ✅
   - renderPersonalitySelect: bg-[#0a0a0c] ✅
   - renderRoleSelect: bg-[#0a0a0c] ✅
   - renderInitializing: bg-[#0a0a0c] ✅
3. Gameplay screens keep existing bg-[#0a0a0c]:
   - renderGame: bg-[#0a0a0c] ✅
   - renderBossFight: bg-[#0a0a0c] ✅
4. Outcome screens keep semantic colors:
   - renderGameOver: bg-[#1a0505] ✅
   - renderSummary: bg-[#051a0d] ✅
5. Button variant patterns documented in code comments
6. Container width strategy documented in code comments
7. Browser verification confirms visual consistency
8. All Playwright tests pass
</verification>

<success_criteria>
- Design token system implemented with CSS variables
- All 6 navigation/gameplay screens use consistent bg-[#0a0a0c]
- Semantic colors preserved for GameOver (#1a0505) and Summary (#051a0d)
- Button variant patterns documented
- Container width strategy documented
- Browser verification confirms visual consistency
- All tests pass
</success_criteria>

<output>
After completion, create `.planning/phases/03-polish-performance/03-02-SUMMARY.md`
</output>
