---
phase: 03-polish-performance
plan: 04
type: execute
wave: 1
depends_on:
  - 03-03
files_modified: []
autonomous: true
gap_closure: true
user_setup: []
must_haves:
  truths:
    - Lighthouse performance score ≥ 90
    - Performance metrics meet targets (FCP < 1.8s, LCP < 2.5s, TBT < 200ms, CLS < 0.1)
    - Lighthouse audit report is available (lighthouse-report.json)
  artifacts:
    - path: lighthouse-report.json
      provides: Lighthouse audit results with score and metrics
      contains: 'categories.performance.score'
  key_links:
    - from: Production build output
      to: Lighthouse audit
      via: Preview server on localhost
      pattern: 'bun run preview'
---

<objective>
Execute the missing Lighthouse performance audit to verify performance score ≥ 90 and document the results.

Purpose: The PERF-01 requirement mandates Lighthouse score ≥ 90 to confirm performance optimizations are successful. This audit was missed in Plan 03-03 and must be completed to fully satisfy phase requirements.
Output: Lighthouse performance report confirming score ≥ 90 with documented metric values
</objective>

<execution_context>
@/Users/yevgenschweden/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/yevgenschweden/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/03-polish-performance/03-03-PLAN.md
@.planning/phases/03-polish-performance/03-03-SUMMARY.md

**Gap Context:**
Task 6 from Plan 03-03 required running a Lighthouse audit to verify performance score ≥ 90. This task was missing from the execution summary and was never completed. The gap closure plan executes this audit and documents the results.

**Current State:**
- Production build output exists (from 03-03 execution)
- Performance optimizations implemented (GPU acceleration, font smoothing, mobile CRT disabled)
- Lighthouse audit was never executed to verify the score target

**Performance Target:**
- Lighthouse Performance Score ≥ 90
- First Contentful Paint (FCP) < 1.8s
- Largest Contentful Paint (LCP) < 2.5s
- Total Blocking Time (TBT) < 200ms
- Cumulative Layout Shift (CLS) < 0.1
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build production bundle and start preview server</name>
  <files></files>
  <action>
  Build the production bundle and start the preview server to serve it for Lighthouse analysis.

  **Build command:**
  ```bash
  bun run build
  ```

  **Start preview server:**
  ```bash
  bun run preview
  ```

  The preview server will run on http://localhost:4173 by default. Wait a few seconds for the server to be ready before running Lighthouse.

  **Note:** The preview server will run in the background for the subsequent task. Ensure port 4173 is available or use an alternative port if needed.
  </action>
  <verify>
    bun run build && echo "Build successful"
    lsof -i :4173 || echo "Preview server will start"
  </verify>
  <done>
    Production build complete and preview server running on http://localhost:4173
  </done>
</task>

<task type="auto">
  <name>Task 2: Run Lighthouse performance audit</name>
  <files>lighthouse-report.json</files>
  <action>
  Run Lighthouse CLI audit on the production build server and save the results.

  **Install Lighthouse if not available:**
  ```bash
  npm install -g lighthouse
  ```

  **Run Lighthouse audit:**
  ```bash
  lighthouse http://localhost:4173 \
    --preset=desktop \
    --only-categories=performance \
    --output=json \
    --output-path=lighthouse-report.json \
    --chrome-flags="--headless --no-sandbox"
  ```

  This command:
  - Runs audit on production build (http://localhost:4173)
  - Uses desktop preset (conservative device constraints)
  - Only analyzes performance category
  - Outputs JSON to lighthouse-report.json
  - Runs in headless mode for CI compatibility

  **Key metrics to verify:**
  - Performance score: Target ≥ 90
  - First Contentful Paint: Target < 1.8s
  - Largest Contentful Paint: Target < 2.5s
  - Total Blocking Time: Target < 200ms
  - Cumulative Layout Shift: Target < 0.1
  </action>
  <verify>
    # Check if report was generated
    if [ -f lighthouse-report.json ]; then
      PERFORMANCE_SCORE=$(jq '.categories.performance.score * 100' lighthouse-report.json)
      echo "Lighthouse Performance Score: $PERFORMANCE_SCORE"

      # Check if target met
      if (( $(echo "$PERFORMANCE_SCORE >= 90" | bc -l) )); then
        echo "✅ Performance target met (≥ 90)"
      else
        echo "⚠️  Performance score below target: $PERFORMANCE_SCORE"
      fi
    else
      echo "❌ lighthouse-report.json not found"
      exit 1
    fi
  </verify>
  <done>
    lighthouse-report.json file exists with performance score ≥ 90 (or documented path to achieve it)
  </done>
</task>

<task type="auto">
  <name>Task 3: Document Lighthouse results</name>
  <files>lighthouse-report.json, 03-04-SUMMARY.md</files>
  <action>
  Document the Lighthouse results in the execution summary, including the score and key metrics.

  **Extract and document metrics:**
  ```bash
  PERFORMANCE_SCORE=$(jq '.categories.performance.score * 100' lighthouse-report.json)
  FCP=$(jq '.audits["first-contentful-paint"].numericValue | floor / 1000' lighthouse-report.json)
  LCP=$(jq '.audits["largest-contentful-prompt"].numericValue | floor / 1000' lighthouse-report.json)
  TBT=$(jq '.audits["total-blocking-time"].numericValue | floor' lighthouse-report.json)
  CLS=$(jq '.audits["cumulative-layout-shift"].numericValue' lighthouse-report.json)
  ```

  **Document findings in SUMMARY.md:**
  - Lighthouse Performance Score
  - All key metric values (FCP, LCP, TBT, CLS)
  - Whether target (≥ 90) was met
  - Any recommendations for improvement if score < 90
  </action>
  <verify>
    jq '.categories.performance.score * 100' lighthouse-report.json
    jq '.audits | keys' lighthouse-report.json
  </verify>
  <done>
    Lighthouse results documented with score and key metrics in SUMMARY.md
  </done>
</task>

</tasks>

<verification>
1. lighthouse-report.json file exists with valid JSON data
2. Lighthouse Performance Score documented (target ≥ 90)
3. Key metrics (FCP, LCP, TBT, CLS) documented
4. Results recorded in execution summary
</verification>

<success_criteria>
- Lighthouse audit executed on production build
- lighthouse-report.json file created with performance score
- Performance score ≥ 90 achieved (or documented improvement path)
- All key metrics (FCP, LCP, TBT, CLS) within target ranges
- Results documented in SUMMARY.md
</success_criteria>

<output>
After completion, create `.planning/phases/03-polish-performance/03-04-SUMMARY.md` with Lighthouse audit results documented
</output>